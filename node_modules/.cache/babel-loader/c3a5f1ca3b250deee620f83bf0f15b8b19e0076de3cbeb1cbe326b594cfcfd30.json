{"ast":null,"code":"import{useRef,useState,useEffect}from\"react\";import*as htmlToImage from\"html-to-image\";import download from\"downloadjs\";import{Card,Button}from\"./components/ui\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ReceiptGenerator=_ref=>{let{data,onReset}=_ref;const receiptRef=useRef(null);const[sortedDates,setSortedDates]=useState([]);const[totalSessions,setTotalSessions]=useState(0);const[startDate,setStartDate]=useState(\"\");const[endDate,setEndDate]=useState(\"\");// Hàm nhận dữ liệu từ ReceiptForm\nuseEffect(()=>{if(data&&data.attendanceDates.length>0){// Chuyển chuỗi ngày sang đối tượng Date, kèm giữ lại chuỗi gốc\nconst datesWithObj=data.attendanceDates.map(dateStr=>{const[day,month,year]=dateStr.split(\"/\");return{original:dateStr,dateObj:new Date(year,month-1,day)};});// Sắp xếp theo thời gian\nconst sortedDatesArray=datesWithObj.sort((a,b)=>a.dateObj-b.dateObj).map(item=>item.original);setSortedDates(sortedDatesArray);setTotalSessions(sortedDatesArray.length);setStartDate(sortedDatesArray[0]);setEndDate(sortedDatesArray[sortedDatesArray.length-1]);}},[data]);const downloadReceipt=()=>{if(!receiptRef.current||!data){alert(\"⚠ Vui lòng nhập thông tin biên lai trước khi tải xuống!\");return;}const firstDate=new Date(startDate.split(\"/\").reverse().join(\"-\"));const monthYear=`${firstDate.getMonth()+1}-${firstDate.getFullYear()}`;const fileName=`${data.studentName}_Thu_học_phí_tháng_${monthYear}.png`;setTimeout(()=>{htmlToImage.toPng(receiptRef.current).then(dataUrl=>{download(dataUrl,fileName);}).catch(error=>{console.error(\"❌ Lỗi khi tạo ảnh:\",error);alert(\"Không thể tạo ảnh hóa đơn. Vui lòng thử lại!\");});},500);};return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(\"div\",{ref:receiptRef,style:{textAlign:\"left\",padding:\"20px\",paddingRight:\"20px\",backgroundColor:\"white\",width:\"525px\",border:\"1px solid #ccc\"},children:[/*#__PURE__*/_jsx(\"h2\",{style:{textAlign:\"center\",textTransform:\"uppercase\",fontSize:\"1.5rem\"},children:\"BI\\xCAN LAI THU TI\\u1EC0N\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"H\\u1ECDc sinh:\"}),\" \",data.studentName]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"L\\u1EDBp:\"}),\" \",data.className]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"S\\u1ED1 ti\\u1EC1n:\"}),\" \",data.amount,\" \\u0111\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"N\\u1ED9i dung:\"}),\" Thu h\\u1ECDc ph\\xED \",totalSessions,\" bu\\u1ED5i t\\u1EEB\",\" \",startDate,\" \\u0111\\u1EBFn \",endDate]}),/*#__PURE__*/_jsx(\"h3\",{style:{marginTop:\"10px\"},children:\"B\\u1EA3ng \\u0111i\\u1EC3m danh\"}),/*#__PURE__*/_jsxs(\"table\",{style:{width:\"100%\",borderCollapse:\"collapse\"},children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{style:{backgroundColor:\"#f5f5f5\",textAlign:\"left\"},children:[/*#__PURE__*/_jsx(\"th\",{style:{padding:\"8px\",borderBottom:\"1px solid #ddd\"},children:\"Ng\\xE0y\"}),/*#__PURE__*/_jsx(\"th\",{style:{padding:\"8px\",borderBottom:\"1px solid #ddd\"},children:\"Tr\\u1EA1ng th\\xE1i\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:sortedDates.map((date,index)=>/*#__PURE__*/_jsxs(\"tr\",{style:{borderBottom:\"1px solid #ddd\"},children:[/*#__PURE__*/_jsx(\"td\",{style:{padding:\"8px\"},children:date}),/*#__PURE__*/_jsx(\"td\",{style:{padding:\"8px\"},children:\"C\\xF3 h\\u1ECDc\"})]},index))})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:\"center\",marginTop:\"20px\",margin:\"0 auto\"},children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Qu\\xE9t m\\xE3 \\u0111\\u1EC3 thanh to\\xE1n\"}),/*#__PURE__*/_jsx(\"img\",{src:\"/img/qr.png\",alt:\"QR Code\",style:{width:\"100px\",height:\"100px\"}}),/*#__PURE__*/_jsx(\"p\",{children:\"Vietcombank\"}),/*#__PURE__*/_jsx(\"p\",{children:\"S\\u1ED1 t\\xE0i kho\\u1EA3n: 1020102766\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Ch\\u1EE7 t\\xE0i kho\\u1EA3n: Nguyen Hue Thien\"})]})]}),/*#__PURE__*/_jsx(Button,{onClick:downloadReceipt,children:\"T\\u1EA3i Bi\\xEAn Lai\"}),/*#__PURE__*/_jsx(Button,{onClick:onReset,children:\"T\\u1EA1o Bi\\xEAn Lai M\\u1EDBi\"})]})});};export default ReceiptGenerator;","map":{"version":3,"names":["useRef","useState","useEffect","htmlToImage","download","Card","Button","jsx","_jsx","jsxs","_jsxs","ReceiptGenerator","_ref","data","onReset","receiptRef","sortedDates","setSortedDates","totalSessions","setTotalSessions","startDate","setStartDate","endDate","setEndDate","attendanceDates","length","datesWithObj","map","dateStr","day","month","year","split","original","dateObj","Date","sortedDatesArray","sort","a","b","item","downloadReceipt","current","alert","firstDate","reverse","join","monthYear","getMonth","getFullYear","fileName","studentName","setTimeout","toPng","then","dataUrl","catch","error","console","children","ref","style","textAlign","padding","paddingRight","backgroundColor","width","border","textTransform","fontSize","className","amount","marginTop","borderCollapse","borderBottom","date","index","margin","src","alt","height","onClick"],"sources":["C:/Users/nguye/receipt-app/src/ReceiptGenerator.js"],"sourcesContent":["import { useRef, useState, useEffect } from \"react\";\r\nimport * as htmlToImage from \"html-to-image\";\r\nimport download from \"downloadjs\";\r\nimport { Card, Button } from \"./components/ui\";\r\n\r\nconst ReceiptGenerator = ({ data, onReset }) => {\r\n  const receiptRef = useRef(null);\r\n  const [sortedDates, setSortedDates] = useState([]);\r\n  const [totalSessions, setTotalSessions] = useState(0);\r\n  const [startDate, setStartDate] = useState(\"\");\r\n  const [endDate, setEndDate] = useState(\"\");\r\n\r\n  // Hàm nhận dữ liệu từ ReceiptForm\r\n  useEffect(() => {\r\n    if (data && data.attendanceDates.length > 0) {\r\n      // Chuyển chuỗi ngày sang đối tượng Date, kèm giữ lại chuỗi gốc\r\n      const datesWithObj = data.attendanceDates.map((dateStr) => {\r\n        const [day, month, year] = dateStr.split(\"/\");\r\n        return {\r\n          original: dateStr,\r\n          dateObj: new Date(year, month - 1, day),\r\n        };\r\n      });\r\n\r\n      // Sắp xếp theo thời gian\r\n      const sortedDatesArray = datesWithObj\r\n        .sort((a, b) => a.dateObj - b.dateObj)\r\n        .map((item) => item.original);\r\n\r\n      setSortedDates(sortedDatesArray);\r\n      setTotalSessions(sortedDatesArray.length);\r\n      setStartDate(sortedDatesArray[0]);\r\n      setEndDate(sortedDatesArray[sortedDatesArray.length - 1]);\r\n    }\r\n  }, [data]);\r\n\r\n  const downloadReceipt = () => {\r\n    if (!receiptRef.current || !data) {\r\n      alert(\"⚠ Vui lòng nhập thông tin biên lai trước khi tải xuống!\");\r\n      return;\r\n    }\r\n\r\n    const firstDate = new Date(startDate.split(\"/\").reverse().join(\"-\"));\r\n    const monthYear = `${firstDate.getMonth() + 1}-${firstDate.getFullYear()}`;\r\n    const fileName = `${data.studentName}_Thu_học_phí_tháng_${monthYear}.png`;\r\n\r\n    setTimeout(() => {\r\n      htmlToImage\r\n        .toPng(receiptRef.current)\r\n        .then((dataUrl) => {\r\n          download(dataUrl, fileName);\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"❌ Lỗi khi tạo ảnh:\", error);\r\n          alert(\"Không thể tạo ảnh hóa đơn. Vui lòng thử lại!\");\r\n        });\r\n    }, 500);\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <Card>\r\n        <div\r\n          ref={receiptRef}\r\n          style={{\r\n            textAlign: \"left\",\r\n            padding: \"20px\",\r\n            paddingRight: \"20px\",\r\n            backgroundColor: \"white\",\r\n            width: \"525px\",\r\n            border: \"1px solid #ccc\",\r\n          }}\r\n        >\r\n          <h2\r\n            style={{\r\n              textAlign: \"center\",\r\n              textTransform: \"uppercase\",\r\n              fontSize: \"1.5rem\",\r\n            }}\r\n          >\r\n            BIÊN LAI THU TIỀN\r\n          </h2>\r\n          <p>\r\n            <strong>Học sinh:</strong> {data.studentName}\r\n          </p>\r\n          <p>\r\n            <strong>Lớp:</strong> {data.className}\r\n          </p>\r\n          <p>\r\n            <strong>Số tiền:</strong> {data.amount} đ\r\n          </p>\r\n          <p>\r\n            <strong>Nội dung:</strong> Thu học phí {totalSessions} buổi từ{\" \"}\r\n            {startDate} đến {endDate}\r\n          </p>\r\n\r\n          <h3 style={{ marginTop: \"10px\" }}>Bảng điểm danh</h3>\r\n          <table style={{ width: \"100%\", borderCollapse: \"collapse\" }}>\r\n            <thead>\r\n              <tr style={{ backgroundColor: \"#f5f5f5\", textAlign: \"left\" }}>\r\n                <th style={{ padding: \"8px\", borderBottom: \"1px solid #ddd\" }}>\r\n                  Ngày\r\n                </th>\r\n                <th style={{ padding: \"8px\", borderBottom: \"1px solid #ddd\" }}>\r\n                  Trạng thái\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {sortedDates.map((date, index) => (\r\n                <tr key={index} style={{ borderBottom: \"1px solid #ddd\" }}>\r\n                  <td style={{ padding: \"8px\" }}>{date}</td>\r\n                  <td style={{ padding: \"8px\" }}>Có học</td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n\r\n          <br />\r\n          <div\r\n            style={{ textAlign: \"center\", marginTop: \"20px\", margin: \"0 auto\" }}\r\n          >\r\n            <h4>Quét mã để thanh toán</h4>\r\n            <img\r\n              src=\"/img/qr.png\"\r\n              alt=\"QR Code\"\r\n              style={{ width: \"100px\", height: \"100px\" }}\r\n            />\r\n            <p>Vietcombank</p>\r\n            <p>Số tài khoản: 1020102766</p>\r\n            <p>Chủ tài khoản: Nguyen Hue Thien</p>\r\n          </div>\r\n        </div>\r\n\r\n        <Button onClick={downloadReceipt}>Tải Biên Lai</Button>\r\n        <Button onClick={onReset}>Tạo Biên Lai Mới</Button>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ReceiptGenerator;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}